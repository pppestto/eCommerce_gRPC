// proto/order/v1/order.proto
syntax = "proto3";

package order.v1;
 
option go_package = "github.com/pppestto/ecommerce-grpc/proto/gen/order/v1";
 
import "user/v1/user.proto";  // импортируем из другого пакета
import "common/common.proto"; // если используем Money

enum OrderStatus {
  ORDER_STATUS_UNSPECIFIED = 0;
  ORDER_STATUS_PENDING     = 1;
  ORDER_STATUS_PAID        = 2;
  ORDER_STATUS_SHIPPED     = 3;
  ORDER_STATUS_CANCELLED   = 4;
}

message OrderItem {
  string product_id = 1;
  int32  quantity   = 2;
  common.Money price = 3;  // используем shared тип
}

message Order {
  string               id     = 1;
  user.v1.User         user   = 2;  // ссылка на User из другого пакета
  repeated OrderItem   items  = 3;
  common.Money         total  = 4;
  OrderStatus          status = 5;
}

message CreateOrderRequest {
  string             user_id = 1;
  repeated OrderItem items   = 2;
}

message CreateOrderResponse {
  Order order = 1;
}

message GetOrderRequest {
  string id = 1;
}

message UpdateOrderStatusRequest {
    string order_id = 1;
    OrderStatus new_status = 2;
}

message UpdateOrderStatusResponse {
    Order order = 1;
}

// Сервис
service OrderService {
  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
  rpc GetOrder(GetOrderRequest) returns (Order);
  rpc UpdateOrderStatus(UpdateOrderStatusRequest) returns (Order);  // добавь сообщение для этого
}